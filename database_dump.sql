-- ========================================================================
-- MILITARY ASSET MANAGEMENT SYSTEM - DATABASE SETUP
-- PostgreSQL Dump File
-- ========================================================================
-- This file contains the complete database schema and initial data
-- for the Military Asset Management System
-- ========================================================================

-- ========================================================================
-- 1. CLEANUP: Start Fresh (Drop everything safely)
-- ========================================================================

DROP TABLE IF EXISTS transfer_log CASCADE;
DROP TABLE IF EXISTS audit_log CASCADE;
DROP TABLE IF EXISTS asset_transactions CASCADE;
DROP TABLE IF EXISTS assets CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS bases CASCADE;
DROP TABLE IF EXISTS base CASCADE;

-- ========================================================================
-- 2. CREATE TABLES
-- ========================================================================

CREATE TABLE bases (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    location VARCHAR(255),
    commander_name VARCHAR(255),
    garrison_type VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(100) NOT NULL,
    base_id BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_user_base FOREIGN KEY (base_id) REFERENCES bases(id) ON DELETE SET NULL
);

CREATE TABLE assets (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    serial_number VARCHAR(255) NOT NULL UNIQUE,
    type VARCHAR(100) NOT NULL,
    status VARCHAR(100) NOT NULL DEFAULT 'ACTIVE',
    current_base_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_asset_base FOREIGN KEY (current_base_id) REFERENCES bases(id) ON DELETE RESTRICT
);

CREATE TABLE asset_transactions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    asset_id BIGINT NOT NULL,
    transaction_type VARCHAR(100),
    from_base_id BIGINT,
    to_base_id BIGINT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_asset_transaction FOREIGN KEY (asset_id) REFERENCES assets(id) ON DELETE CASCADE
);

CREATE TABLE transfer_log (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    asset_name VARCHAR(255) NOT NULL,
    source_base VARCHAR(255),
    dest_base VARCHAR(255),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE audit_log (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    action_type VARCHAR(100) NOT NULL,
    asset_name VARCHAR(255),
    details VARCHAR(500),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ========================================================================
-- 3. CREATE INDEXES FOR PERFORMANCE
-- ========================================================================

CREATE INDEX idx_assets_serial_number ON assets(serial_number);
CREATE INDEX idx_assets_status ON assets(status);
CREATE INDEX idx_assets_current_base ON assets(current_base_id);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_audit_log_timestamp ON audit_log(timestamp);
CREATE INDEX idx_transfer_log_timestamp ON transfer_log(timestamp);

-- ========================================================================
-- 4. INSERT BASE DATA (INDIAN MILITARY BASES)
-- ========================================================================

INSERT INTO bases (name, location, commander_name, garrison_type) VALUES 
('Indraprastha HQ', 'New Delhi', 'Brig. Suryadev Singh', 'Headquarters'),
('Siachen Base Camp', 'Ladakh', 'Col. Vikram Batra Memorial', 'High Altitude'),
('Dipatoli Cantonment', 'Ranchi', 'Maj. Ravi Kumar', 'Training Center'),
('Fort Alpha', 'Mumbai', 'Col. Ashok Verma', 'Naval'),
('Camp Bravo', 'Pune', 'Brig. Prakash Sharma', 'Storage');

-- ========================================================================
-- 5. INSERT USER DATA (Password: password123, BCrypt Hashed)
-- BCrypt Hash: $2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm
-- ========================================================================

INSERT INTO users (username, password, role, base_id) VALUES 
-- Admin users (can manage everything)
('admin_user', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'ADMIN', NULL),
('admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'ADMIN', 1),

-- Logistics officers (can create purchases and transfers)
('logistics_officer', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'LOGISTICS', 1),
('log_officer_delhi', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'LOGISTICS', 1),

-- Commanders (base-specific access)
('commander_delhi', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'COMMANDER', 1),
('commander_siachen', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'COMMANDER', 2),
('commander_ranchi', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'COMMANDER', 3),
('commander_mumbai', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'COMMANDER', 4),
('commander_pune', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOcd7.od.3.pm', 'COMMANDER', 5);

-- ========================================================================
-- 6. INSERT ASSET DATA (Rich Dataset with Mixed Statuses)
-- ========================================================================

-- VEHICLES (12 items)
INSERT INTO assets (name, serial_number, type, status, current_base_id) VALUES 
('T-90 Bhishma Tank', 'TANK-IND-001', 'VEHICLE', 'ACTIVE', 1),
('T-90 Bhishma Tank', 'TANK-IND-002', 'VEHICLE', 'ASSIGNED', 2),
('T-90 Bhishma Tank', 'TANK-IND-003', 'VEHICLE', 'ACTIVE', 3),
('Ashok Leyland Stallion', 'TRUCK-IND-101', 'VEHICLE', 'ACTIVE', 3),
('Ashok Leyland Stallion', 'TRUCK-IND-102', 'VEHICLE', 'EXPENDED', 2),
('Ashok Leyland Stallion', 'TRUCK-IND-103', 'VEHICLE', 'ASSIGNED', 4),
('Tata Safari GS800', 'LMV-IND-005', 'VEHICLE', 'ASSIGNED', 1),
('Tata Safari GS800', 'LMV-IND-006', 'VEHICLE', 'ACTIVE', 5),
('Maruti Gypsy King', 'LMV-IND-009', 'VEHICLE', 'ACTIVE', 3),
('Mahindra Bolero Pik-Up', 'LMV-IND-010', 'VEHICLE', 'ASSIGNED', 2),
('Bharatiya Armoured Vehicle', 'BAV-IND-001', 'VEHICLE', 'ACTIVE', 1),
('HMMWV Humvee', 'HMMWV-IND-001', 'VEHICLE', 'ASSIGNED', 4);

-- WEAPONS (16 items)
INSERT INTO assets (name, serial_number, type, status, current_base_id) VALUES 
('INSAS Rifle 5.56mm', 'WPN-RIF-101', 'WEAPON', 'ASSIGNED', 3),
('INSAS Rifle 5.56mm', 'WPN-RIF-102', 'WEAPON', 'ACTIVE', 3),
('INSAS Rifle 5.56mm', 'WPN-RIF-103', 'WEAPON', 'ACTIVE', 1),
('AK-203 Assault Rifle', 'WPN-AK-201', 'WEAPON', 'ACTIVE', 2),
('AK-203 Assault Rifle', 'WPN-AK-202', 'WEAPON', 'ASSIGNED', 2),
('AK-203 Assault Rifle', 'WPN-AK-203', 'WEAPON', 'ACTIVE', 5),
('Sig Sauer 716 Rifle', 'WPN-SIG-301', 'WEAPON', 'ACTIVE', 1),
('Sig Sauer 716 Rifle', 'WPN-SIG-302', 'WEAPON', 'ASSIGNED', 4),
('Dragunov SVD Sniper', 'WPN-SNP-055', 'WEAPON', 'ASSIGNED', 2),
('Dragunov SVD Sniper', 'WPN-SNP-056', 'WEAPON', 'ACTIVE', 3),
('Carl Gustaf M4 Launcher', 'RL-IND-001', 'WEAPON', 'EXPENDED', 2),
('Panzerfaust 3 Launcher', 'RL-IND-002', 'WEAPON', 'ACTIVE', 1),
('9mm Service Pistol', 'WPN-PST-009', 'WEAPON', 'ACTIVE', 1),
('9mm Service Pistol', 'WPN-PST-010', 'WEAPON', 'ASSIGNED', 2),
('12 Gauge Combat Shotgun', 'WPN-SHG-001', 'WEAPON', 'ACTIVE', 5),
('Heckler Koch MP5', 'WPN-MP5-001', 'WEAPON', 'ASSIGNED', 4);

-- AMMUNITION & EQUIPMENT (12 items)
INSERT INTO assets (name, serial_number, type, status, current_base_id) VALUES 
('5.56mm Ammo Crate (1000rds)', 'AMMO-556-001', 'AMMUNITION', 'ACTIVE', 3),
('5.56mm Ammo Crate (1000rds)', 'AMMO-556-002', 'AMMUNITION', 'ACTIVE', 1),
('7.62mm Ammo Crate (500rds)', 'AMMO-762-001', 'AMMUNITION', 'EXPENDED', 2),
('7.62mm Ammo Crate (500rds)', 'AMMO-762-002', 'AMMUNITION', 'ACTIVE', 5),
('155mm Artillery Shells', 'AMMO-ART-901', 'AMMUNITION', 'ACTIVE', 1),
('155mm Artillery Shells', 'AMMO-ART-902', 'AMMUNITION', 'ASSIGNED', 3),
('9mm Pistol Ammo Box', 'AMMO-9MM-001', 'AMMUNITION', 'ACTIVE', 1),
('Mortar Rounds 81mm', 'AMMO-MOR-101', 'AMMUNITION', 'ACTIVE', 2),
('Hand Grenades (RDG)', 'AMMO-GRN-001', 'AMMUNITION', 'ACTIVE', 4),
('Night Vision Goggles', 'EQ-NVG-101', 'WEAPON', 'ASSIGNED', 2),
('Thermal Imaging System', 'EQ-THERMAL-001', 'WEAPON', 'ACTIVE', 1),
('Satellite Communication System', 'EQ-SAT-COM-001', 'WEAPON', 'ACTIVE', 5);

-- ========================================================================
-- 7. INSERT AUDIT LOG DATA (Transaction History)
-- ========================================================================

INSERT INTO audit_log (action_type, asset_name, details, timestamp) VALUES 
('PURCHASE', 'T-90 Bhishma Tank', 'Base: Indraprastha HQ', NOW() - INTERVAL '30 days'),
('PURCHASE', 'INSAS Rifle 5.56mm', 'Base: Dipatoli Cantonment', NOW() - INTERVAL '25 days'),
('PURCHASE', 'AK-203 Assault Rifle', 'Base: Siachen Base Camp', NOW() - INTERVAL '20 days'),
('TRANSFER', 'T-90 Bhishma Tank', 'Transferred to Siachen Base Camp', NOW() - INTERVAL '15 days'),
('ASSIGN', 'INSAS Rifle 5.56mm', 'To: Sepoy Singh (Ranchi)', NOW() - INTERVAL '10 days'),
('TRANSFER', 'AK-203 Assault Rifle', 'Moved to Pune Camp Bravo', NOW() - INTERVAL '8 days'),
('ASSIGN', 'Dragunov SVD Sniper', 'To: Havildar Sharma', NOW() - INTERVAL '5 days'),
('ASSIGN', 'Tata Safari GS800', 'To: Col. Verma', NOW() - INTERVAL '3 days'),
('EXPEND', 'Carl Gustaf M4 Launcher', 'Destroyed during training exercise', NOW() - INTERVAL '2 days'),
('EXPEND', '7.62mm Ammo Crate (500rds)', 'Ammunition expended in operations', NOW() - INTERVAL '1 day'),
('PURCHASE', '9mm Service Pistol', 'Base: Indraprastha HQ', NOW() - INTERVAL '1 day'),
('ASSIGN', 'Night Vision Goggles', 'To: Capt. Arun Kumar', NOW());

-- ========================================================================
-- 8. INSERT TRANSFER LOG DATA (Movement History)
-- ========================================================================

INSERT INTO transfer_log (asset_name, source_base, dest_base, timestamp) VALUES 
('T-90 Bhishma Tank', 'Indraprastha HQ', 'Siachen Base Camp', NOW() - INTERVAL '15 days'),
('INSAS Rifle 5.56mm', 'Indraprastha HQ', 'Dipatoli Cantonment', NOW() - INTERVAL '12 days'),
('AK-203 Assault Rifle', 'Dipatoli Cantonment', 'Siachen Base Camp', NOW() - INTERVAL '8 days'),
('Ashok Leyland Stallion', 'Fort Alpha', 'Camp Bravo', NOW() - INTERVAL '5 days'),
('Sig Sauer 716 Rifle', 'Indraprastha HQ', 'Fort Alpha', NOW() - INTERVAL '3 days'),
('5.56mm Ammo Crate (1000rds)', 'Camp Bravo', 'Dipatoli Cantonment', NOW() - INTERVAL '2 days'),
('Heckler Koch MP5', 'Indraprastha HQ', 'Fort Alpha', NOW() - INTERVAL '1 day'),
('Tata Safari GS800', 'Camp Bravo', 'Indraprastha HQ', NOW());

-- ========================================================================
-- 9. VERIFY SETUP
-- ========================================================================

-- Count records in each table
SELECT 'Bases' as table_name, COUNT(*) as record_count FROM bases
UNION ALL
SELECT 'Users', COUNT(*) FROM users
UNION ALL
SELECT 'Assets', COUNT(*) FROM assets
UNION ALL
SELECT 'Audit Logs', COUNT(*) FROM audit_log
UNION ALL
SELECT 'Transfer Logs', COUNT(*) FROM transfer_log;

-- ========================================================================
-- DATABASE SETUP COMPLETE
-- ========================================================================
-- Total Records:
-- Bases: 5
-- Users: 9 (1 ADMIN, 1 general ADMIN, 2 LOGISTICS, 5 COMMANDERS)
-- Assets: 40 (12 Vehicles, 16 Weapons, 12 Ammunition/Equipment)
-- Audit Logs: 12 transactions
-- Transfer Logs: 8 transfers
--
-- Login Credentials (all passwords: password123):
-- - admin_user / password123
-- - logistics_officer / password123
-- - commander_delhi / password123
-- - commander_siachen / password123
-- - commander_ranchi / password123
-- ========================================================================
